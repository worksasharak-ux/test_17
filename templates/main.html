{% extends 'parts/base.html' %}

{% block title %}
    –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤
{% endblock %}

{% block content %}

<div class="auth-card">
    <h4 class="notifications-title">üîî –ù–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
    {% if unviewed_posts %}
        <ul class="notifications-list">
            {% for unviewed_post in unviewed_posts %}
                <li class="notification-item">
                    <a href="{% url 'post' unviewed_post.pk %}" class="notification-link">
                        <span class="notification-status">New Post</span>
                        from <span class="notification-author">@{{ unviewed_post.author.username }}</span>
                        <time class="notification-date">{{ unviewed_post.created_at|date:"d E, H:i" }}</time>
                    </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="notifications-empty">–ü–æ–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤ –Ω–µ—Ç</p>
    {% endif %}
</div>
<!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è / –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<div class="auth-card">
    {% if user.is_authenticated %}
        <h3>üëã –ü—Ä–∏–≤–µ—Ç, <span style="color: var(--accent);">{{ user.username }}</span></h3>
        <div class="nav-links">
            <a href="/user/create-post" class="btn-link">üìù –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</a>
            <a href="/" class="btn-link">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            {% if user_page %}
                {% if request.user.pk != user_page.pk %}
                    {% if subscribed %}
                        <a href="{% url 'subscribe' user_page.pk %}" class="btn-link">–û—Ç–ø–∏—Å–∞—Ç—å—Å—è</a>
                    {% else %}
                        <a href="{% url 'subscribe' user_page.pk %}" class="btn-link">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</a>
                    {% endif %}
                {% endif %}
            {% endif %}
            <a href="/logout/" class="btn-link danger-btn">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</a>
        </div>
    {% else %}
        <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h3>
        <div class="nav-links">
            <a href="/login/" class="btn-link">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
            <a href="/register/" class="btn-link secondary-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        </div>
    {% endif %}
</div>

<!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ª–µ–Ω—Ç—ã -->
<div class="header-card" style="padding: 12px; text-align: center; border-bottom: 2px solid var(--accent);">
    <span style="color: var(--text-muted); font-weight: 600; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px;">
        {{ user_page|default:"–°–≤–µ–∂–∏–µ –∑–∞–ø–∏—Å–∏" }} ‚Ä¢ {{ posts.count }}
    </span>
</div>

<!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
{% for post in posts %}
    <article class="post-card">
        <div class="post-header">
            <a href="{% url 'posts_id' post.author.id %}" class="post-author">
                {{ post.author.username }}
            </a>
        </div>

        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∞–º –ø–æ—Å—Ç -->
        <a href="{% url 'post' post.id %}" class="post-link" style="display: block; margin: 15px 0; text-decoration: none; color: var(--text-main);">
            <p class="post-text">{{ post.post_text }}</p>
        </a>

        <!-- –ù–û–í–´–ô –ë–õ–û–ö: –í—ã–≤–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        {% if post.picture %}
        <div class="post-image-container" style="margin-bottom: 15px;">
            <a href="{% url 'post' post.id %}">
                <img src="{{ post.picture.url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å—Ç–∞"
                     style="width: 100%; border-radius: 8px; display: block; object-fit: cover; max-height: 500px;">
            </a>
        </div>
        {% endif %}

        <!-- –õ–∞–π–∫–∏ -->
        <div class="post-likes">
            <form method="post" action="/post/{{ post.pk }}/like/">
                {% csrf_token %}
                <button type="submit" class="btn-like">
                    <span class="heart-icon">‚ù§</span>
                    <span class="likes-count">{{ post.likes_count }}</span>
                </button>
            </form>
        </div>

        <div class="post-footer">
            <time class="post-time">{{ post.post_time|date:"d E Y, H:i" }}</time>
        </div>
    </article>
{% empty %}
    <div class="post-card" style="text-align: center; color: var(--text-muted); padding: 40px;">
        <p>üì≠ –¢—É—Ç –ø–æ–∫–∞ –ø—É—Å—Ç–æ, —Å—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º –∞–≤—Ç–æ—Ä–æ–º!</p>
    </div>
{% endfor %}

{% endblock %}
